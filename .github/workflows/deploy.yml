# Half-RTA deploy
name: deploy

on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

env:
  MAP_VER: Half-RTA_

jobs:     
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - working-directory: ./Half-RTA
      run: pwd
    - name: Read VERSION file
      working-directory: ./Half-RTA
      id: getversion
      run: echo "version=$(awk 'END {print $NF}' Maps/Multiplayer/Half-RTA/messages/map_name.txt)" >> $GITHUB_OUTPUT
    - name: Get version
      working-directory: ./Half-RTA
      id: vars
      run: echo ::set-output name=version::$(awk 'END {print $NF}' Maps/Multiplayer/Half-RTA/messages/map_name.txt)
    - name: Test output
      run: echo ${{ steps.vars.outputs.version }}${{ steps.getversion.outputs.version }}
    - name: Raname Dir
      working-directory: ./Half-RTA/
      run: mv Maps/Multiplayer/Half-RTA Maps/Multiplayer/${{ env.MAP_VER }}${{ steps.getversion.outputs.version }}
    - name: Zip Map
      working-directory: ./Half-RTA
      run: zip -r ${{ env.MAP_VER }}${{ steps.getversion.outputs.version }}.h5m .
    - run: mkdir -p path/to/artifact
    - name: Copy Map
      run: cp -r Half-RTA/${{ env.MAP_VER }}${{ steps.getversion.outputs.version }}.h5m path/to/artifact
    #- name: Copy Exe
    #  run: cp -r Exe/H5_Game.exe path/to/artifact
    - uses: actions/upload-artifact@v3
      with:
        name: ${{ env.MAP_VER }}${{ steps.getversion.outputs.version }}
        path: path/to/artifact/
